<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Identity‑Anchored Encryption · Mark Cooper
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Mark Cooper">
<meta name="description" content="An identity‑centric encryption model where every record is protected with its own key, and decryption requires verified identity, explicit user approval, and full auditability.">
<meta name="keywords" content="">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Identity‑Anchored Encryption">
  <meta name="twitter:description" content="An identity‑centric encryption model where every record is protected with its own key, and decryption requires verified identity, explicit user approval, and full auditability.">

<meta property="og:url" content="https://mdcooper-mc.github.io/projects/identity-centric-encryption-with-user-consent/">
  <meta property="og:site_name" content="Mark Cooper">
  <meta property="og:title" content="Identity‑Anchored Encryption">
  <meta property="og:description" content="An identity‑centric encryption model where every record is protected with its own key, and decryption requires verified identity, explicit user approval, and full auditability.">
  <meta property="og:locale" content="en_uk">
  <meta property="og:type" content="article">
    <meta property="article:section" content="projects">




<link rel="canonical" href="https://mdcooper-mc.github.io/projects/identity-centric-encryption-with-user-consent/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.022594d625780e2edf64581b893d32cb35c11de5d88953ea4ad3c2e45451e214.css" integrity="sha256-AiWU1iV4Di7fZFgbiT0yyzXBHeXYiVPqStPC5FRR4hQ=" crossorigin="anonymous" media="screen" />








 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>




<body class="preload-transitions colorscheme-light">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://mdcooper-mc.github.io/">
      Mark Cooper
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/projects/">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/platforms/">Platforms</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="https://mdcooper-mc.github.io/projects/identity-centric-encryption-with-user-consent/">
          Identity‑Anchored Encryption
        </a>
      </h1>
    </header>

    <p>This project demonstrates how encryption can be made <strong>identity‑centric</strong> — shifting control from purely key‑based
systems to ones anchored in user identity and consent. Each record is encrypted with its own random key, which is then
wrapped with the user’s public key. Even if one key is compromised, only that single record is exposed.</p>
<p>Decryption is never automatic. It requires:</p>
<ol>
<li>A valid identity token (JWT) issued by the Identity Provider (Okta).</li>
<li>Explicit user approval if the actor requesting access is not the data owner.</li>
<li>A successful unwrap of the record’s encryption key by the Key Management Service.</li>
</ol>
<p>Every decrypt event is logged with actor, subject, purpose, and key version, ensuring a defensible audit trail. This
makes the Identity Provider the <strong>front door for decryption</strong> — the arbiter of whether access is legitimate.</p>
<hr>
<h1 id="per-user-envelope-encryption-with-okta-approval">
  Per-user Envelope Encryption with Okta Approval
  <a class="heading-link" href="#per-user-envelope-encryption-with-okta-approval">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<h2 id="plain-language-summary-for-non-technical-readers">
  Plain-language Summary (for non-technical readers)
  <a class="heading-link" href="#plain-language-summary-for-non-technical-readers">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>We are designing a system to keep each customer’s information safe.<br>
Here’s the simple idea:</p>
<ul>
<li>Every piece of data is locked with its own unique “padlock” (a random key).</li>
<li>That padlock is then sealed inside a box that only the customer’s personal key can open.</li>
<li>When someone (like support staff) needs to see the data, they must:<br>
    1. Prove who they are by signing in.<br>
    2. Get the customer’s approval if they are not the customer themselves.<br>
    3. Only then can the system unlock the padlock and show the information.</li>
<li>Every time this happens, it is recorded so there’s a clear trail of who accessed what and why.</li>
</ul>
<p>This means:</p>
<ul>
<li>Customers stay in control of their own information.</li>
<li>Support staff can help, but only with permission.</li>
<li>Even if one padlock is broken, it only affects that single piece of data, not everything.</li>
</ul>
<hr>
<h2 id="overview">
  Overview
  <a class="heading-link" href="#overview">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>Encrypt each record with a random <strong>Data Encryption Key (DEK)</strong>.</li>
<li>Wrap the DEK with the user’s <strong>public key</strong>.</li>
<li>Require a valid <strong>JWT</strong> and <strong>user approval</strong> (if impersonated) to unwrap the DEK.</li>
<li>Audit every decrypt with both actor and subject identities.</li>
</ul>
<hr>
<h2 id="write-path-encrypt">
  Write Path (Encrypt)
  <a class="heading-link" href="#write-path-encrypt">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ol>
<li>
<p><strong>Identify subject</strong><br>
<code>user_sub</code> = stable ID from Okta.</p>
</li>
<li>
<p><strong>Generate DEK</strong><br>
Random symmetric key (AES-GCM), used only for this record.</p>
</li>
<li>
<p><strong>Encrypt data</strong><br>
<code>ciphertext = Encrypt(data, DEK)</code></p>
</li>
<li>
<p><strong>Wrap DEK</strong><br>
<code>wrappedDEK = Encrypt(DEK, user_public_key)</code></p>
</li>
<li>
<p><strong>Store record</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#f92672">&#34;user_sub&#34;</span>: <span style="color:#e6db74">&#34;00u123...&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">&#34;ciphertext&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">&#34;wrappedDEK&#34;</span>: <span style="color:#e6db74">&#34;...&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">&#34;kid&#34;</span>: <span style="color:#e6db74">&#34;k_v1&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
</ol>
<hr>
<h2 id="read-path-decrypt">
  Read Path (Decrypt)
  <a class="heading-link" href="#read-path-decrypt">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ol>
<li>
<p><strong>Authenticate actor</strong></p>
<ul>
<li>Validate JWT from Okta.</li>
<li>If actor ≠ subject → trigger Okta approval flow.</li>
<li>Only proceed if approval granted.</li>
</ul>
</li>
<li>
<p><strong>Fetch record</strong></p>
<ul>
<li>Retrieve <code>ciphertext</code>, <code>wrappedDEK</code>, <code>kid</code>.</li>
</ul>
</li>
<li>
<p><strong>Unwrap DEK</strong><br>
<code>DEK = Decrypt(wrappedDEK, user_private_key)</code><br>
(private key held securely in KMS or user device).</p>
</li>
<li>
<p><strong>Decrypt ciphertext</strong><br>
<code>plaintext = Decrypt(ciphertext, DEK)</code></p>
</li>
<li>
<p><strong>Audit</strong></p>
<ul>
<li>Log <code>actorSub</code>, <code>subjectSub</code>, <code>approval</code>, <code>kid</code>, <code>timestamp</code>.</li>
</ul>
</li>
</ol>
<hr>
<h2 id="key-concepts">
  Key Concepts
  <a class="heading-link" href="#key-concepts">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li><strong>DEK:</strong> Short-lived, random key used to encrypt actual data; exists only in memory during operations.</li>
<li><strong>Public/Private Key Pair (PPK):</strong><br>
  - Public key: stored in Okta or a key registry; used to wrap DEKs.<br>
  - Private key: never leaves secure storage; used to unwrap DEKs.</li>
<li><strong>Approval Flow:</strong> Okta push/email prompt ensures the subject consents when actor ≠ subject.</li>
<li><strong>Audit Trail:</strong> Every decrypt event records actor, subject, purpose, and key version.</li>
</ul>
<hr>
<h2 id="one-liner-summaries">
  One-Liner Summaries
  <a class="heading-link" href="#one-liner-summaries">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>
<p><strong>Encrypt:</strong><br>
<code>(user_sub, data → [generate DEK → encrypt data → wrap DEK with user’s public key])</code></p>
</li>
<li>
<p><strong>Decrypt:</strong><br>
<code>(JWT + Okta approval → unwrap DEK with user’s private key → decrypt ciphertext → return plaintext)</code></p>
</li>
</ul>
<hr>
<h2 id="your-shorthand-mnemonics">
  Your Shorthand Mnemonics
  <a class="heading-link" href="#your-shorthand-mnemonics">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>
<p><strong>Encrypt:</strong><br>
[user_sub, data (PPK &gt; DEK &raquo; data)]</p>
</li>
<li>
<p><strong>Decrypt:</strong><br>
JWT (approval flow via Okta [user/supportuser]) → DEK unwrap → decrypt key → decrypt(enc_text)</p>
</li>
</ul>
<hr>
<h2 id="identity-provider-as-the-front-door">
  Identity Provider as the Front Door
  <a class="heading-link" href="#identity-provider-as-the-front-door">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>In this model, the <strong>Identity Provider (Okta)</strong> is not just authenticating users but also acting as the <strong>policy
gatekeeper</strong> for decryption:</p>
<ul>
<li>
<p><strong>Identity Provider (IdP) role:</strong><br>
  - Issues JWTs binding actor identity (<code>actor_sub</code>) and subject identity (<code>user_sub</code>).<br>
  - Enforces approval workflows (push/email consent).<br>
  - Provides claims that the KMS/decrypt service uses to decide whether to unwrap the DEK.</p>
</li>
<li>
<p><strong>Key Management role:</strong><br>
  - Holds private/master keys.<br>
  - Only unwraps DEKs if IdP-backed claims say “yes.”<br>
  - Logs every unwrap with actor/subject context.</p>
</li>
<li>
<p><strong>Application role:</strong><br>
  - Stores ciphertext + wrapped DEK.<br>
  - Calls out to IdP + KMS when a decrypt is requested.<br>
  - Returns plaintext only after both identity and approval checks pass.</p>
</li>
</ul>
<p><strong>Key takeaway:</strong> Okta becomes the <strong>front door for decryption</strong> — the arbiter of whether a decrypt request is
legitimate. This shifts the model from being purely key-centric to being <strong>identity-centric</strong>, with consent and
auditability built in.</p>
<hr>
<h2 id="skills">
  Skills
  <a class="heading-link" href="#skills">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p><strong>Languages &amp; Frameworks</strong><br>
Python | Go | Rust | Markdown Documentation | Okta SDKs</p>
<p><strong>Security &amp; Identity</strong><br>
JWT | Okta Approval Flows | Consent‑Driven Access | Audit Logging</p>
<p><strong>Encryption &amp; Key Management</strong><br>
Envelope Encryption | Per‑Record DEKs | AES‑GCM | KMS/HSM Integration | Public/Private Key Wrapping</p>
<p><strong>Architecture &amp; Design</strong><br>
Identity‑Centric Security | Modular Microservices | Consent‑First Workflows | Regulatory Defensibility</p>
<p><strong>Documentation &amp; Communication</strong><br>
Narrative‑Driven Markdown | Business‑Friendly Summaries | Shorthand Mnemonics | Example‑Rich Use Cases</p>

  </article>
</section>

  

    </div>

    <footer style="text-align:center; font-size: 11px; color: rgb(0, 0, 0);">
    <div>
        <p>© 2025 Mark Cooper - <a href="mailto:mdcooper.mc@gmail.com?subject=Please%20send%20me%20a%20copy%20of%20your%20CV">Request a CV</a></p>
    </div>
</footer>
  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
